<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leverage Testing</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .jumbotron {
            background-color: #343a40;
            color: #fff;
            padding: 100px 20px;
            margin-bottom: 0;
        }
        .nav-item {
            margin-right: 10px;
        }
        .slider-label {
            font-weight: bold;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="jumbotron text-center">
        <h1 class="display-4">Leverage Testing</h1>
        <p class="lead">The goal of leverage testing is to find the optimal amount of leverage (daily leverage) to trade with of certain timeframes. To achieve this, I will implement a website with easy UI to backtest strategies.</p>
    </div>

    <nav class="navbar navbar-expand-sm bg-dark navbar-dark">
        <ul class="navbar-nav mx-auto">
            <li class="nav-item">
                <a class="nav-link" href="/">Home</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/leverage_testing">Leverage Testing</a>
            </li>
        </ul>
    </nav>

    <div class="container mt-5">
        <h2 class="mb-4">Graphs</h2>
        <div class="row">
            <div class="col-md-6 order-md-2">
                <canvas id="timeStockChart" width="600" height="400"></canvas>
                <div class="form-group mt-4">
                    <label class="slider-label" for="leverageRange">Leverage Amount: <span id="leverageAmount">5</span></label>
                    <input type="range" class="form-control-range" id="leverageRange" min="1" max="10" step="0.1" value="5">
                </div>
            </div>
            <div class="col-md-6 order-md-1">
                <canvas id="leverageReturnsChart" width="600" height="400"></canvas>
                <div class="form-group mt-4">
                    <label class="slider-label" for="timeRange">Time Range:</label>
                    <div id="timeRangeSlider"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        
        // Generate random data for the first graph (Leverage vs Annualized Returns)
        var leverageData = [];
        var returnsData = [];
        for (var i = 0; i < 10; i++) {
            leverageData.push(Math.random() * 10); // Random leverage values
            returnsData.push(Math.random() * 100); // Random annualized returns values
        }

        // Generate random data for the second graph (Time vs Stock Performance)
        var timeData = [];
        var stockData = [];
        for (var i = 0; i < 10; i++) {
            timeData.push(i); // Time values (0 to 9)
            stockData.push(Math.random() * 1000); // Random stock performance values
        }

        // Create the first chart (Leverage vs Annualized Returns)
        var leverageReturnsChartCtx = document.getElementById('leverageReturnsChart').getContext('2d');
        var leverageReturnsChart = new Chart(leverageReturnsChartCtx, {
            type: 'scatter',
            data: {
                datasets: [{
                    label: 'Leverage vs Annualized Returns',
                    data: leverageData.map((value, index) => ({ x: value, y: returnsData[index] })),
                    backgroundColor: 'rgba(255, 99, 132, 0.5)',
                    borderColor: 'rgba(255, 99, 132, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    x: {
                        type: 'linear',
                        position: 'bottom'
                    },
                    y: {
                        type: 'linear',
                        position: 'left'
                    }
                }
            }
        });

        // Create the second chart (Time vs Stock Performance)
        var timeStockChartCtx = document.getElementById('timeStockChart').getContext('2d');
        var timeStockChart = new Chart(timeStockChartCtx, {
            type: 'line',
            data: {
                labels: timeData,
                datasets: [{
                    label: 'Time vs Stock Performance',
                    data: stockData,
                    fill: false,
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    x: {
                        type: 'linear',
                        position: 'bottom'
                    },
                    y: {
                        type: 'linear',
                        position: 'left'
                    }
                }
            }
        });

        // Function to update the label with the current value of the leverage amount
        function updateLeverageAmount(value) {
            $('#leverageAmount').text(value);
        }

        // Function to update the label with the current value of the time range
        function updateTimeRange(min, max) {
            $('#timeRangeLabel').text(min + ' - ' + max);
        }

        
        // Initialize the jQuery UI slider for time range
        $(function() {

            // Event listener for the leverage range slider
            $('#leverageRange').on('input', function() {
                var value = $(this).val();
                updateLeverageAmount(value);
            });

            // Event listener for the time range slider
            $('#timeRangeSlider').on('input', function() {
                var min = $(this).val().split(',')[0];
                var max = $(this).val().split(',')[1];
                updateTimeRange(min, max);
            });

            $("#timeRangeSlider").slider({
                range: true,
                time_min: 0,
                time_max: 100,
                values: [0, 100],
                slide: function(event, ui) {
                    // Update chart based on time range
                    // You can implement this logic as needed

                    // Get the current slider values
                    var time_min = ui.values[0];
                    var time_max = ui.values[1];

                    // Update the slider background color
                    updateSlider(time_min, time_max);

                    $.ajax({
                        type: "POST",
                        url: "/update_slider",
                        data: { time_min: time_min, time_max: time_max },
                        success: function(response) {
                            console.log(response);
                        },
                        error: function(xhr, status, error) {
                            console.error(error);
                        }
                    });
                }
            });

            // Function to update slider display
            function updateSlider(time_min, time_max) {
                var range = time_max - time_min;
                var percentMin = ((time_min - $("#timeRangeSlider").slider("option", "time_min")) / range) * 100;
                var percentMax = ((time_max - $("#timeRangeSlider").slider("option", "time_min")) / range) * 100;
                $("#timeRangeSlider").css('background', 'linear-gradient(to right, #007bff ' + percentMin + '%, #007bff ' + percentMax + '%, #ced4da ' + percentMax + '%, #ced4da 100%)');
            }


        });
    </script>
</body>
</html>
